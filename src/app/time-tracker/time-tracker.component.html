<app-navbar />
<p-card class="p-card-body">
  <div class="p-card-content">
    <div class="mb-4 mt-4" style="position: relative; width: 100%;">
      <p>9 Hours : Cumulative hours spent(approx.)</p>
      <p-progressBar [showValue]="false" [value]="sharedProgress">
      </p-progressBar>
      <span
        style="position: absolute; top: 75%; left: 50%; transform: translate(-50%, -50%); font-weight: bold; text-align: center;">
        {{ formatTime(totalElapsedTime) }}</span>
    </div>
    <div class="grid mb-3">
      <div class="col-3">
        <p-datepicker [(ngModel)]="dates" [maxDate]="maxDate" appendTo="body" />
      </div>
      <div class="col-3">
        <p-select [options]="clients" [fluid]="true" [checkmark]="true" [(ngModel)]="selectedClients" appendTo="body"
          optionLabel="c_name" (onChange)="getProjects($event)" placeholder="Select Clients"
          styleClass="w-full md:w-100" />
      </div>
      @if (projects.length !== 0) {
      <div class="col-3">
        <p-select [options]="projects" [fluid]="true" [checkmark]="true" [(ngModel)]="selectedprojects" appendTo="body"
          optionLabel="p_name" (onChange)="getTasks($event)" placeholder="Select Projects"
          styleClass="w-full md:w-100" />
      </div>
      }
    </div>
    <p-table [value]="taskss" showGridlines dataKey="id">
      <ng-template #header>
        <tr>
          <th width="16%" style="text-align: center;">
            Clone
          </th>
          <th width="16%" style="text-align: center;">
            tasks
          </th>
          <th width="16%" style="text-align: center;">
            Start Time
          </th>
          <th width="16%" style="text-align: center;">
            End Time
          </th>
          <th width="16%" style="text-align: center;">
            Total Time
          </th>
          <th width="16%" style="text-align: center;">
            Description
          </th>
        </tr>
      </ng-template>
      <ng-template #body let-data let-editing="editing">
        <tr>
          <td style="text-align: center;">
            <p-toast />
            <p-button (click)="cloneData(data)" label="clone" icon="pi pi-clone" [disabled]="disableClone" />
          </td>
          <td style="text-align: center;" [pEditableColumn]="data.t_name" pEditableColumnField="t_name">
            <p-cellEditor>
              <ng-template #input>
                <p-select [options]="tasks" [checkmark]="true" [(ngModel)]="data.t_name" appendTo="body"
                  optionLabel="t_name" (onChange)="getTaskName($event)" placeholder="Select tasks" />
              </ng-template>
            </p-cellEditor>
            {{data?.taskss?.t_name}}
          </td>
          <td style="text-align: center;" [pEditableColumn]="data.start_time" pEditableColumnField="start_time">
            <p-cellEditor>
              <ng-template #input>
                <p-datepicker [(ngModel)]="data.start_time" appendTo="body" [timeOnly]="true" [showSeconds]="true"
                  [hourFormat]="'24'" (ngModelChange)="calculateTotalTime(data)" [showTime]="true" />
              </ng-template>
              <ng-template #output>
                {{data.start_time | date:'HH:mm:ss'}}
              </ng-template>
            </p-cellEditor>
          </td>
          <td style="text-align: center;" [pEditableColumn]="data.end_time" pEditableColumnField="end_time">
            <p-cellEditor>
              <ng-template #input>
                <p-datepicker [(ngModel)]="data.end_time" appendTo="body" [timeOnly]="true" [showSeconds]="true"
                  [hourFormat]="'24'" (ngModelChange)="calculateTotalTime(data)" [showTime]="true" />
              </ng-template>
              <ng-template #output>
                {{data.end_time | date:'HH:mm:ss'}}
              </ng-template>
            </p-cellEditor>
          </td>
          <td style="text-align: center;">
            {{data.totalTime}}
          </td>
          <td style="text-align: center;" [pEditableColumn]="data.description" pEditableColumnField="description">
            <p-cellEditor>
              <ng-template #input>
                <input pInputText [(ngModel)]="data.description" />
              </ng-template>
              <ng-template #output>
                {{data.description}}
              </ng-template>
            </p-cellEditor>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
  <div class="mt-3" style="justify-content: end; display: flex;">
    <p-button (click)="logs()" label="add" icon="pi pi-plus" />
  </div>
</p-card>
